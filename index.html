<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<!-- Facebook -->
<meta property="og:title" content="NYC-DSA LIVE RESULTS">
<meta property="og:description" content="Follow the 2020 New York Primary results live with NYC-DSA.">
<meta property="og:image" content="img/dsa-for-the-many.jpg">
<meta property="og:url" content="https://results.socialists.nyc/">
<!-- Twitter -->
<meta name="twitter:title" content="NYC-DSA LIVE RESULTS">
<meta name="twitter:description" content="Follow the 2020 New York Primary results live with NYC-DSA.">
<meta name="twitter:image" content="https://results.socialists.nyc/img/dsa-for-the-many.jpg?0">
<meta name="twitter:card" content="summary_large_image">
<link rel="icon" href="img/4_red_full.png" type="image/png">
<script src="js/main.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin="">
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
   crossorigin=""></script>
<link rel="stylesheet" href="css/main.css">
<style type="text/css">
@media screen and (max-width: 720px) {
  html, body {
    margin: 0 0;
    width: 100%;
  }

  footer {
    margin-top: 10px;
    text-align: left;
  }

  th.vote-share-cell, td.vote-share-cell {
    display: none;
  }
}
</style>
</head>
<body>
  <header>
    <a href="https://www.socialists.nyc/"><img id="nyc-dsa-logo" src="img/4_red_full.png" alt="logo" style="width:100px;height:100px" /></a>
    <br>
    <p id="take-action">
      <button class="action-button" title="Return to the main page" onclick="window.location.href='index.html';">Main Page</button>
      <button class="action-button" title="View election district results" onclick="window.location.href='full-results.html';">Detailed Results</button>
      <button class="action-button" title="View results from past NYC-DSA-endorsed campaigns" onclick="window.location.href='past-results.html';">Past Elections</button>
      <button class="action-button" title="Join DSA" onclick="window.open('https://dsausa.org/join','_blank');">Join DSA</button>
      <button class="action-button" title="Make a recurring donation to NYC-DSA's PAC" onclick="window.open('https://secure.actblue.com/donate/nyc-dsa-pac-1?refcode=results-site&recurring=1','_blank');">Donate to NYC-DSA's PAC</button>
      <!--<button class="action-button" title="Sign up for the NYC-DSA Racial Justice Working Groupâ€™s DefundNYPD campaign" onclick="window.open('https://defundnypd.com','_blank');">Join the #DefundNYPD Campaign</button>-->
    </p>
  </header>
  <h1 id="title"></h1>
  <div id="results">
  </div>
<script type="text/javascript">
// define dropdown lists and their options
var url = new URL(window.location.href),
    defaultYear = "2021",
    year = url.searchParams.get("year") || defaultYear,
    file = `data/${year}/summary.tsv`;

d3.select("#title").html(`${config[year]["election"]} Election Results`);

d3.tsv(file, d3.autoType)
  .then(data => {
    var nested = d3.nest()
        .key(d => d.district)
        .entries(data);

    nested.forEach(district => {
      var div = d3.select("#results").append("div"),
          sorted = district.values.sort((a, b) => d3.descending(a.votes, b.votes));

      buildHeader(div, district.key);
      buildResultsTable(div, sorted, config[year]["columns"]);
      div.append("p")
          .attr("class", "total-results")
          .html(`
            ${sorted[0].total.toLocaleString()} votes (${percentage(sorted[0].total, sorted[0].reg_dems)}% turnout)<br>
            ${sorted[0].reporting.toLocaleString()} of ${sorted[0].precincts} election districts ${(sorted[0].reporting < sorted[0].precincts ?  "partially " : "")}reporting<br>
            <br>
            ${year == "2021" ? "Unofficial results from Round 1<br>" : ""}
            Last updated on ${config[year]["districts"][district.key].lastUpdated}
          `);

      div.append("p")
          .attr("class", "results-p")
          .html(`<a href='full-results.html?year=${year}&district=${district.key}'>Election district results</a>`);
    });
  });
</script>
<footer>
  <p>
    <span>
    <span>Source: <a href="https://github.com/sabrinadchan/dsa-for-the-many">https://github.com/sabrinadchan/dsa-for-the-many</a> |
    </span>
    <span>Geospatial Data: <a href="https://data.cityofnewyork.us/City-Government/Election-Districts/h2n3-98hq">NYC Open Data</a>
    </span> | 
    <span>Election results: <a href="https://vote.nyc/">NYC BOE</a>
    </span>
  </p> 
</footer>
</body>
</html>
